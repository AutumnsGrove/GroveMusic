# GroveMusic Frontend - Cloudflare Pages Configuration
# Pipeline Worker with DOs will be in /workers/pipeline/

name = "grovemusic"
compatibility_date = "2025-12-01"
compatibility_flags = ["nodejs_compat"]
pages_build_output_dir = ".svelte-kit/cloudflare"

# ─────────────────────────────────────────────────────────────────────────────
# D1 Database
# ─────────────────────────────────────────────────────────────────────────────
[[d1_databases]]
binding = "DB"
database_name = "grovemusic-db"
database_id = "e1e31ed2-3b1f-4dbd-9435-c9105dadcfa2"

# ─────────────────────────────────────────────────────────────────────────────
# KV Namespaces
# ─────────────────────────────────────────────────────────────────────────────

[[kv_namespaces]]
binding = "CACHE"
id = "677a09cfeb5c4afe9bac24240c1fcc6d"

[[kv_namespaces]]
binding = "SESSIONS"
id = "46c5fb1dd2d04385a7e624b2e4730ad6"

[[kv_namespaces]]
binding = "RATE_LIMITS"
id = "d5c976093f344aba948f77f37d29194a"

[[kv_namespaces]]
binding = "CONFIG"
id = "6488be12cf90402caf6ced7bf156ad6c"

# ─────────────────────────────────────────────────────────────────────────────
# R2 Object Storage
# ─────────────────────────────────────────────────────────────────────────────
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "grovemusic-storage"

# ─────────────────────────────────────────────────────────────────────────────
# Vectorize Index
# ─────────────────────────────────────────────────────────────────────────────
[[vectorize]]
binding = "TRACKS"
index_name = "grovemusic-tracks"

# ─────────────────────────────────────────────────────────────────────────────
# Service Binding to Pipeline Worker (add after pipeline worker is deployed)
# ─────────────────────────────────────────────────────────────────────────────
# [[services]]
# binding = "PIPELINE"
# service = "grovemusic-pipeline"

# ─────────────────────────────────────────────────────────────────────────────
# Environment Variables
# ─────────────────────────────────────────────────────────────────────────────
[vars]
APP_URL = "https://music.grove.place"
ENVIRONMENT = "production"

[env.preview]
vars = { ENVIRONMENT = "preview" }

[env.production]
vars = { APP_URL = "https://music.grove.place", ENVIRONMENT = "production" }
